<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>consoletest Sphinx extension &mdash; DFFML 5b53a7dbe documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Debugging" href="debugging.html" />
    <link rel="prev" title="Notebooks" href="notebooks.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> DFFML
          </a>
              <div class="version">
                5b53a7dbe
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/index.html">Concepts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/model.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Examples</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../plugins/index.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli.html">Command Line</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins/service/http/index.html">HTTP API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/base.html">Base</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/log.html">Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/noasync.html">Noasync</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/plugins.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/record.html">Record</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/version.html">Version</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/db/index.html">Db</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/cli/index.html">Cli</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/df/index.html">Df</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/high_level/index.html">High_Level</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/tuner/index.html">Tuner</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/service/index.html">Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/util/index.html">Util</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/configloader/index.html">Configloader</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/accuracy/index.html">Accuracy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/source/index.html">Source</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/operation/index.html">Operation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/model/index.html">Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/secret/index.html">Secret</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/port/index.html">Port</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/feature/index.html">Feature</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../arch/index.html">Architecture</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Subprojects</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../shouldi.html">shouldi</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Community</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference external" href="https://github.com/intel/dffml">GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://intel.github.io/dffml/main/">Master Branch Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contact.html">Contact Us</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Contributing</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="dev_community.html">What To Work On</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_env.html">Getting Set Up To Work On DFFML</a></li>
<li class="toctree-l2"><a class="reference internal" href="style.html">Style</a></li>
<li class="toctree-l2"><a class="reference internal" href="codebase.html">Codebase Layout And Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="git.html">Git and GitHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="testing.html">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="docs.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="notebooks.html">Notebooks</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">consoletest Sphinx extension</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#example">Example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#conf-py"><code class="docutils literal notranslate"><span class="pre">conf.py</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#options">Options</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#code-block"><code class="docutils literal notranslate"><span class="pre">code-block</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#literalinclude"><code class="docutils literal notranslate"><span class="pre">literalinclude</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="debugging.html">Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="editors/index.html">Setting Up Your Editor</a></li>
<li class="toctree-l2"><a class="reference internal" href="gsoc/index.html">Google Summer of Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="maintainers.html">Maintainer Docs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../news/index.html">News</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">DFFML</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Contributing</a> &raquo;</li>
      <li>consoletest Sphinx extension</li>


      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/intel/dffml/blob/main/docs/contributing/consoletest.md" class="fa fa-github"> Edit on GitHub</a>
      </li>


  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="consoletest-sphinx-extension">
<h1>consoletest Sphinx extension<a class="headerlink" href="#consoletest-sphinx-extension" title="Permalink to this headline"></a></h1>
<p>This Sphinx extension allows you to tests your <code class="docutils literal notranslate"><span class="pre">code-block</span></code> and
<code class="docutils literal notranslate"><span class="pre">literalinclude</span></code> directives in your documentation to make sure that the command
you’re telling users to run, and the files you’re telling them to write, produce
intended results.</p>
<p>Video explaining: https://www.youtube.com/watch?v=DrftXxzqJpg</p>
<ul class="simple">
<li><p><a class="reference external" href="#example">Example</a></p></li>
<li><p><a class="reference external" href="#confpy"><code class="docutils literal notranslate"><span class="pre">conf.py</span></code></a></p></li>
<li><p><a class="reference external" href="#options">Options</a></p>
<ul>
<li><p><a class="reference external" href="#code-block"><code class="docutils literal notranslate"><span class="pre">code-block</span></code></a></p></li>
<li><p><a class="reference external" href="#literalinclude"><code class="docutils literal notranslate"><span class="pre">literalinclude</span></code></a></p></li>
</ul>
</li>
</ul>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline"></a></h2>
<p>Each <code class="docutils literal notranslate"><span class="pre">.rst</span></code>, <code class="docutils literal notranslate"><span class="pre">.md</span></code>, .etc file will get it’s own temporary directory in which the
test will run.</p>
<p>One “test” is the running of all directives in a file marked with the <code class="docutils literal notranslate"><span class="pre">:test:</span></code>
option.</p>
<p>We can run <code class="docutils literal notranslate"><span class="pre">consoletest</span></code> on a file by invoicing it as a Python module. We’ll
test the following command in this document by running:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python -m dffml.util.testing.consoletest dffml/util/testing/consoletest/README.md
</pre></div>
</div>
<p>Write out this <code class="docutils literal notranslate"><span class="pre">README.md</span></code> file into the temporary directory which is the
current working directory.</p>
<div class="highlight-rst notranslate"><div class="highlight"><pre><span></span><span class="p">..</span> <span class="ow">literalinclude</span><span class="p">::</span> README.md
    <span class="nc">:test:</span>
</pre></div>
</div>
<p>Start an HTTP server which will serve the content of the current working
directory. Mark the server as a daemon which will run in the background for the
remainder of the test of this document.</p>
<div class="highlight-rst notranslate"><div class="highlight"><pre><span></span><span class="p">..</span> <span class="ow">code-block</span><span class="p">::</span> console
    <span class="nc">:test:</span>
    <span class="nc">:daemon:</span> 8000

    $ python -m http.server
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">poll-until</span></code> means run the following command until the contents of the
Python code in the <code class="docutils literal notranslate"><span class="pre">compare-output</span></code> option evaluates to <code class="docutils literal notranslate"><span class="pre">True</span></code>. Ignore any
errors by specifying the <code class="docutils literal notranslate"><span class="pre">ignore-errors</span></code> option.</p>
<p>Content of command can be replaced using the <code class="docutils literal notranslate"><span class="pre">:replace:</span></code> option. Usually you’ll
want to use this if something you need in the example relies on a value within
the <code class="docutils literal notranslate"><span class="pre">ctx</span></code> dictionary. When starting the built in Python http server, the port
that the server binds to will be stored in the <code class="docutils literal notranslate"><span class="pre">HTTP_SERVER</span></code> dictionary in the
context. By default the server binds to port <code class="docutils literal notranslate"><span class="pre">8000</span></code>, if you tell it to bind on
another port, you’ll want to reference the <code class="docutils literal notranslate"><span class="pre">HTTP_SERVER</span></code> dictionary to find out
what random port it is really bound to for the test’s lifetime. We always bind
to random ports to avoid collisions with already bound services.</p>
<p>The current working directory can be accessed via <code class="docutils literal notranslate"><span class="pre">ctx[&quot;cwd&quot;]</span></code>.</p>
<div class="highlight-rst notranslate"><div class="highlight"><pre><span></span><span class="p">..</span> <span class="ow">code-block</span><span class="p">::</span> console
    <span class="nc">:test:</span>
    <span class="nc">:poll-until:</span>
    <span class="nc">:ignore-errors:</span>
    <span class="nc">:compare-output:</span> bool(b&quot;:compare-output:&quot; in stdout)
    <span class="nc">:replace:</span> cmds[0][-1] = cmds[0][-1].replace(&quot;8000&quot;, str(ctx[&quot;HTTP_SERVER&quot;][&quot;8000&quot;]))

    $ curl -sfL http://localhost:8000/README.md
</pre></div>
</div>
<p>Declare that we want to replace the existing daemon labeled “8000” with this new
process. Terminate the previously running HTTP server by sending it a <code class="docutils literal notranslate"><span class="pre">Ctrl-C</span></code>.</p>
<div class="highlight-rst notranslate"><div class="highlight"><pre><span></span><span class="p">..</span> <span class="ow">code-block</span><span class="p">::</span> console
    <span class="nc">:test:</span>
    <span class="nc">:daemon:</span> 8000

    $ python -m http.server --cgi 8000
</pre></div>
</div>
<p>Commands should be placed on separate lines, <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> and command substitution are
currently not supported.</p>
<div class="highlight-rst notranslate"><div class="highlight"><pre><span></span><span class="p">..</span> <span class="ow">code-block</span><span class="p">::</span> console
    <span class="nc">:test:</span>

    $ mkdir cgi-bin
    $ chmod 755 cgi-bin
    $ touch cgi-bin/api.py
</pre></div>
</div>
<div class="highlight-rst notranslate"><div class="highlight"><pre><span></span><span class="p">..</span> <span class="ow">code-block</span><span class="p">::</span> console
    <span class="nc">:test:</span>
    <span class="nc">:replace:</span> import os; cmds[-1][-1] = os.path.join(ctx[&quot;cwd&quot;], cmds[-1][-1])

    $ ls -lAFR
    $ chmod 755 cgi-bin/api.py
</pre></div>
</div>
<p>Contents of <code class="docutils literal notranslate"><span class="pre">code-block</span></code> directives can also be written to files</p>
<div class="highlight-rst notranslate"><div class="highlight"><pre><span></span><span class="p">..</span> <span class="ow">code-block</span><span class="p">::</span> python
    <span class="nc">:test:</span>
    <span class="nc">:filepath:</span> cgi-bin/api.py

    #!/usr/bin/env python
    import os
    import sys
    import json
    import urllib.parse

    print(&quot;Content-Type: application/json&quot;)
    print()

    query = dict(urllib.parse.parse_qsl(os.getenv(&quot;QUERY_STRING&quot;, default=&quot;&quot;)))
</pre></div>
</div>
<p>When a <code class="docutils literal notranslate"><span class="pre">code-block</span></code> results in a write to a file, if the <code class="docutils literal notranslate"><span class="pre">:overwrite:</span></code> option
is left off, contents will be appended to the file, rather than overwriting.</p>
<div class="highlight-rst notranslate"><div class="highlight"><pre><span></span><span class="p">..</span> <span class="ow">code-block</span><span class="p">::</span> python
    <span class="nc">:test:</span>
    <span class="nc">:filepath:</span> cgi-bin/api.py

    print(json.dumps(query))

    sys.stdout.flush()
</pre></div>
</div>
<p>Pipes are supported. The <code class="docutils literal notranslate"><span class="pre">stdin</span></code> option allows for specifying the input to a
command. String literals will be decoded, for example <code class="docutils literal notranslate"><span class="pre">\n</span></code> will become a
newline.</p>
<div class="highlight-rst notranslate"><div class="highlight"><pre><span></span><span class="p">..</span> <span class="ow">code-block</span><span class="p">::</span> console
    <span class="nc">:test:</span>
    <span class="nc">:stdin:</span> Hello World

    $ cat
    Hello World
</pre></div>
</div>
<p>When running network clients such as <code class="docutils literal notranslate"><span class="pre">curl</span></code> against a server, you will sometimes
need to use <code class="docutils literal notranslate"><span class="pre">:poll-until:</span></code> and <code class="docutils literal notranslate"><span class="pre">:ignore-errors:</span></code> to re-run the client until the
server is ready to respond to requests.</p>
<div class="highlight-rst notranslate"><div class="highlight"><pre><span></span><span class="p">..</span> <span class="ow">code-block</span><span class="p">::</span> console
    <span class="nc">:test:</span>
    <span class="nc">:poll-until:</span>
    <span class="nc">:ignore-errors:</span>
    <span class="nc">:compare-output-imports:</span> json
    <span class="nc">:compare-output:</span> bool({&quot;Hello&quot;: &quot;World&quot;} == json.loads(stdout.decode()))
    <span class="nc">:replace:</span> cmds[0][-1] = cmds[0][-1].replace(&quot;8000&quot;, str(ctx[&quot;HTTP_SERVER&quot;][&quot;8000&quot;]))

    $ curl -vfL http://localhost:8000/cgi-bin/api.py?Hello=World
</pre></div>
</div>
<section id="conf-py">
<h3><code class="docutils literal notranslate"><span class="pre">conf.py</span></code><a class="headerlink" href="#conf-py" title="Permalink to this headline"></a></h3>
<p>If you install DFFML you will have <code class="docutils literal notranslate"><span class="pre">consoletest</span></code> installed. Simply add it to
your list of extensions using it’s full path.</p>
<p><strong>conf.py</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">extensions</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">...</span>
    <span class="s2">&quot;dffml.util.testing.consoletest.builder&quot;</span><span class="p">,</span>
    <span class="o">...</span>
<span class="p">]</span>
</pre></div>
</div>
<p>It needs to be configured by defining three variables.</p>
<ul class="simple">
<li><p>The path to the root of your git repo</p></li>
<li><p>The path to the docs source</p></li>
<li><p>If desired, Python code (as a <code class="docutils literal notranslate"><span class="pre">str</span></code>) containing an <code class="docutils literal notranslate"><span class="pre">async</span></code> function named
<code class="docutils literal notranslate"><span class="pre">setup()</span></code> which will be run before each test.</p></li>
</ul>
<p><strong>conf.py</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">consoletest_root</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s2">&quot;..&quot;</span><span class="p">)</span>
<span class="n">consoletest_docs</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">consoletest_root</span><span class="p">,</span> <span class="s2">&quot;docs&quot;</span><span class="p">)</span>
<span class="n">consoletest_test_setup</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;consoletest_test_setup.py&quot;</span>
<span class="p">)</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span>
</pre></div>
</div>
<p>Here is an example of <code class="docutils literal notranslate"><span class="pre">consoletest_test_setup.py</span></code> which resides in the same
directory as <code class="docutils literal notranslate"><span class="pre">conf.py</span></code> (per above configuration).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">setup()</span></code> function in this example</p>
<ul class="simple">
<li><p>Creates a new virtual environment (a <code class="docutils literal notranslate"><span class="pre">conda</span></code> environment will be created if
running within an activated <code class="docutils literal notranslate"><span class="pre">conda</span></code> environment already)</p></li>
<li><p>Activates the virtual environment</p></li>
<li><p>Installs the latest versions of <code class="docutils literal notranslate"><span class="pre">pip</span></code>, <code class="docutils literal notranslate"><span class="pre">setuptools</span></code>, and <code class="docutils literal notranslate"><span class="pre">wheel</span></code></p></li>
<li><p>Installs the package at the root of the git repo (<code class="docutils literal notranslate"><span class="pre">consoletest_root</span></code>) in
development mode. This way each tests starts with an isolated environment
containing the packages being tested already installed.</p></li>
</ul>
<p><strong>consoletest_test_setup.py</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tempfile</span>

<span class="kn">from</span> <span class="nn">dffml.util.testing.consoletest.commands</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">CreateVirtualEnvCommand</span><span class="p">,</span>
    <span class="n">ActivateVirtualEnvCommand</span><span class="p">,</span>
    <span class="n">PipInstallCommand</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a virtualenv for every document</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">venvdir</span> <span class="o">=</span> <span class="n">ctx</span><span class="p">[</span><span class="s2">&quot;stack&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">enter_context</span><span class="p">(</span><span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">())</span>

    <span class="n">ctx</span><span class="p">[</span><span class="s2">&quot;venv&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">venvdir</span>

    <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="n">CreateVirtualEnvCommand</span><span class="p">(</span><span class="n">ctx</span><span class="p">[</span><span class="s2">&quot;venv&quot;</span><span class="p">]),</span>
        <span class="n">ActivateVirtualEnvCommand</span><span class="p">(</span><span class="n">ctx</span><span class="p">[</span><span class="s2">&quot;venv&quot;</span><span class="p">]),</span>
        <span class="n">PipInstallCommand</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;python&quot;</span><span class="p">,</span>
                <span class="s2">&quot;-m&quot;</span><span class="p">,</span>
                <span class="s2">&quot;pip&quot;</span><span class="p">,</span>
                <span class="s2">&quot;install&quot;</span><span class="p">,</span>
                <span class="s2">&quot;-U&quot;</span><span class="p">,</span>
                <span class="s2">&quot;pip&quot;</span><span class="p">,</span>
                <span class="s2">&quot;setuptools&quot;</span><span class="p">,</span>
                <span class="s2">&quot;wheel&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">),</span>
        <span class="n">PipInstallCommand</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;python&quot;</span><span class="p">,</span>
                <span class="s2">&quot;-m&quot;</span><span class="p">,</span>
                <span class="s2">&quot;pip&quot;</span><span class="p">,</span>
                <span class="s2">&quot;install&quot;</span><span class="p">,</span>
                <span class="s2">&quot;-U&quot;</span><span class="p">,</span>
                <span class="s2">&quot;-e&quot;</span><span class="p">,</span>
                <span class="n">ctx</span><span class="p">[</span><span class="s2">&quot;root&quot;</span><span class="p">],</span>
            <span class="p">]</span>
        <span class="p">),</span>
    <span class="p">]:</span>
        <span class="nb">print</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[setup] Running&quot;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">command</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">()</span>
        <span class="k">await</span> <span class="n">ctx</span><span class="p">[</span><span class="s2">&quot;astack&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">enter_async_context</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">command</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="options">
<h2>Options<a class="headerlink" href="#options" title="Permalink to this headline"></a></h2>
<p>Multiple options have been added to the <code class="docutils literal notranslate"><span class="pre">code-block</span></code> and <code class="docutils literal notranslate"><span class="pre">literalinclude</span></code>
directives.</p>
<section id="code-block">
<h3><code class="docutils literal notranslate"><span class="pre">code-block</span></code><a class="headerlink" href="#code-block" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">test</span></code>: Boolean</p>
<ul>
<li><p>Run this <code class="docutils literal notranslate"><span class="pre">code-block</span></code> as a part of the <code class="docutils literal notranslate"><span class="pre">consoletest</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">filepath</span></code>: String</p>
<ul>
<li><p>Write the contents of the <code class="docutils literal notranslate"><span class="pre">code-block</span></code> to this file path relative to the
currnet working directory (<code class="docutils literal notranslate"><span class="pre">ctx[&quot;cwd&quot;]</span></code>)</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">overwrite</span></code>: Boolean</p>
<ul>
<li><p>If the filepath for the <code class="docutils literal notranslate"><span class="pre">code-block</span></code> exists and overwrite evaluates to
<code class="docutils literal notranslate"><span class="pre">True</span></code>, replace the contents of the file with the contents of the file with
the contents of this <code class="docutils literal notranslate"><span class="pre">code-block</span></code>. If <code class="docutils literal notranslate"><span class="pre">overwrite</span></code> evaluates to <code class="docutils literal notranslate"><span class="pre">False</span></code>,
append the contents of the <code class="docutils literal notranslate"><span class="pre">code-block</span></code> to the file.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">replace</span></code>: Python code</p>
<ul>
<li><p>Replace parts of commands before they are run. Useful if a command needs
access to something within the <code class="docutils literal notranslate"><span class="pre">ctx</span></code>.</p></li>
<li><p>Example: <code class="docutils literal notranslate"><span class="pre">:replace:</span> <span class="pre">cmds[0][-5]</span> <span class="pre">=</span> <span class="pre">cmds[0][-5].replace(&quot;8080&quot;,</span> <span class="pre">str(ctx[&quot;HTTP_SERVER&quot;][&quot;8080&quot;]))</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">poll-until</span></code>: Boolean</p>
<ul>
<li><p>Run the command until <code class="docutils literal notranslate"><span class="pre">:compare-output:</span></code> evaluates to <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ignore-errors</span></code>: Boolean</p>
<ul>
<li><p>Do not fail the whole test if the command exits with a non-zero exit code.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">compare-output-imports</span></code>: Comma separated list of Python modules</p>
<ul>
<li><p>Python modules to import before running <code class="docutils literal notranslate"><span class="pre">compare-output</span></code></p></li>
<li><p>Example: <code class="docutils literal notranslate"><span class="pre">:compare-output-import:</span> <span class="pre">os,</span> <span class="pre">json</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">compare-output</span></code>: Python code</p>
<ul>
<li><p>Body of Python lambda used to check if output of command was as expected</p></li>
<li><p>Example: <code class="docutils literal notranslate"><span class="pre">:compare-output:</span> <span class="pre">bool(json.loads(stdout.decode())</span> <span class="pre">==</span> <span class="pre">json.loads(os.environ['VAR']))</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">daemon</span></code>: String</p>
<ul>
<li><p>Do not wait for the command to finish before running the next command. Run
the command in the background until the test run is over, or until another
command is run with the same string given.</p></li>
<li><p>Example: <code class="docutils literal notranslate"><span class="pre">:daemon:</span> <span class="pre">my-background-process</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">stdin</span></code>: String</p>
<ul>
<li><p>Data to use as the processes input. String literals will be converted.
For example <code class="docutils literal notranslate"><span class="pre">\n</span></code> becomes a new line.</p></li>
<li><p>Example: <code class="docutils literal notranslate"><span class="pre">Hello\nWorld</span></code></p></li>
</ul>
</li>
</ul>
</section>
<section id="literalinclude">
<h3><code class="docutils literal notranslate"><span class="pre">literalinclude</span></code><a class="headerlink" href="#literalinclude" title="Permalink to this headline"></a></h3>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">test</span></code>: Boolean</p>
<ul class="simple">
<li><p>Copy the file referenced by this <code class="docutils literal notranslate"><span class="pre">literalinclude</span></code> into the current working
directory (<code class="docutils literal notranslate"><span class="pre">ctx[&quot;cwd&quot;]</span></code>) as a part of the <code class="docutils literal notranslate"><span class="pre">consoletest</span></code>.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">filepath</span></code>: String</p>
<ul>
<li><p>Write the contents of the file referenced by <code class="docutils literal notranslate"><span class="pre">literalinclude</span></code> to this file
path relative to the current working directory (<code class="docutils literal notranslate"><span class="pre">ctx[&quot;cwd&quot;]</span></code>).</p>
<p>If this option is not given the basename of the file referenced by
<code class="docutils literal notranslate"><span class="pre">literalinclude</span></code> will be used.</p>
</li>
</ul>
</li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="notebooks.html" class="btn btn-neutral float-left" title="Notebooks" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="debugging.html" class="btn btn-neutral float-right" title="Debugging" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017 - 2022, Intel.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>